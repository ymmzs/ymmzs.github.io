<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<title>å‘˜å·¥æ‰“å¡å¯è§†åŒ–</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  html, body, #map { height:100%; margin:0; padding:0; }
  #debug {
    position:fixed; left:8px; top:8px; z-index:99999;
    background:rgba(0,0,0,.55); color:#fff; font:12px Menlo,monospace;
    padding:6px 8px; border-radius:6px; white-space:pre-wrap; max-width:45vw;
  }
</style>
<!-- å®‰å…¨å¯†é’¥è¦åœ¨ AMap è„šæœ¬å‰è®¾ç½® -->
<script>
  window._AMapSecurityConfig = {
    securityJsCode: '4f2f784efc2d91f05503cc67c9d1bae8'
  };
</script>
<script src="https://webapi.amap.com/maps?v=2.0&key=caf9ae6b677894d55e07fea480fcdc6d&plugin=AMap.ToolBar,AMap.Scale,AMap.DistrictSearch"></script>
</head>
<body>
<div id="map"></div>
<div id="debug">bootâ€¦</div>
<script>
(function(){
  const dbg = document.getElementById('debug');
  const LOG = (...a)=>{ console.log(...a); dbg.textContent += '\n' + a.join(' '); };

  var map = new AMap.Map('map', {
    zoom: 5,
    center: [113.462747, 24.667952],
    viewMode: '2D'
  });
  LOG('map ready');

  var points = [{"name": "é¾šæ¥", "address": "å¹¿ä¸œçœç æµ·å¸‚é‡‘æ¹¾åŒºåˆ›ä¸šä¸­è·¯2å·", "province": "å¹¿ä¸œçœ", "position": [113.281266, 22.08831], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é¾šæ¥<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœç æµ·å¸‚é‡‘æ¹¾åŒºåˆ›ä¸šä¸­è·¯2å·"}, {"name": "é¾™è¿œå¿—", "address": "çœ‰å±±å¸‚ä¸œå¡åŒºä¸œå¡åŒºé˜³å…‰æœªæ¥åŸ(èœ€å±±è·¯å—)", "province": "å››å·çœ", "position": [103.833874, 30.068128], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é¾™è¿œå¿—<br/><b>ğŸ“ åœ°å€ï¼š</b>å››å·çœ çœ‰å±±å¸‚ä¸œå¡åŒºä¸œå¡åŒºé˜³å…‰æœªæ¥åŸ(èœ€å±±è·¯å—)"}, {"name": "é¾™å¼€å‰", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é¾™å¼€å‰<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é½å®—", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é½å®—<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»å‹‡", "address": "å¹¿ä¸œçœæ·±åœ³å¸‚é¾™å²—åŒºå®é¾™ä¸€è·¯å®é¾™ä¸€è·¯27-5å·", "province": "å¹¿ä¸œçœ", "position": [114.286956, 22.687053], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»å‹‡<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœæ·±åœ³å¸‚é¾™å²—åŒºå®é¾™ä¸€è·¯å®é¾™ä¸€è·¯27-5å·"}, {"name": "é»„é›„å®‰", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„é›„å®‰<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„é’°æ¾", "address": "å››å·çœçœ‰å±±å¸‚ä¸œå¡åŒºé«˜æ–°æŠ€æœ¯äº§ä¸šå›­åŒºä¸‡åå¤§é“1å·", "province": "å››å·çœ", "position": [103.764853, 30.036396], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„é’°æ¾<br/><b>ğŸ“ åœ°å€ï¼š</b>å››å·çœ å››å·çœçœ‰å±±å¸‚ä¸œå¡åŒºé«˜æ–°æŠ€æœ¯äº§ä¸šå›­åŒºä¸‡åå¤§é“1å·"}, {"name": "é»„è¹", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„è¹<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„ç«‹å‹‡", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„ç«‹å‹‡<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„æ¶¦é¾™", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ¶¦é¾™<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„æ¡‚è´µ", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ¡‚è´µ<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„æ™¨æ›¦", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ™¨æ›¦<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„æ™“çœŸ", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ™“çœŸ<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„æ˜çœŸ", "address": "å®‰å¾½çœæ·®åŒ—å¸‚ç›¸å±±åŒºé—¸æ²³è·¯", "province": "å®‰å¾½çœ", "position": [116.802292, 33.969743], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ˜çœŸ<br/><b>ğŸ“ åœ°å€ï¼š</b>å®‰å¾½çœ å®‰å¾½çœæ·®åŒ—å¸‚ç›¸å±±åŒºé—¸æ²³è·¯"}, {"name": "é»„æ–¹çƒ¨", "address": "å¸¸å·å¸‚æº§é˜³å¸‚æº§é˜³å¸‚è’‹åº—æ–°åŸ", "province": "æ±Ÿè‹çœ", "position": [119.415721, 31.442724], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„æ–¹çƒ¨<br/><b>ğŸ“ åœ°å€ï¼š</b>æ±Ÿè‹çœ å¸¸å·å¸‚æº§é˜³å¸‚æº§é˜³å¸‚è’‹åº—æ–°åŸ"}, {"name": "é»„å¿—å›½", "address": "æ¹–åŒ—çœå®œæ˜Œå¸‚å…´å±±å¿æ€ä¹¡è·¯", "province": "æ¹–åŒ—çœ", "position": [110.759097, 31.228418], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„å¿—å›½<br/><b>ğŸ“ åœ°å€ï¼š</b>æ¹–åŒ—çœ æ¹–åŒ—çœå®œæ˜Œå¸‚å…´å±±å¿æ€ä¹¡è·¯"}, {"name": "é»„å°§", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„å°§<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„å®¶ç…§", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„å®¶ç…§<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„å®å…‰", "address": "ç¦å»ºçœå®å¾·å¸‚è•‰åŸåŒºæŒ¯å…´è·¯", "province": "ç¦å»ºçœ", "position": [119.55388, 26.718301], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„å®å…‰<br/><b>ğŸ“ åœ°å€ï¼š</b>ç¦å»ºçœ ç¦å»ºçœå®å¾·å¸‚è•‰åŸåŒºæŒ¯å…´è·¯"}, {"name": "é»„å¦™å", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„å¦™å<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é»„ä¿Š", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é»„ä¿Š<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é«˜é¹é£", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é«˜é¹é£<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é«˜èŒ‚è™", "address": "å¹¿ä¸œçœè‚‡åº†å¸‚é«˜è¦åŒºåˆ›ä¸šå››è·¯", "province": "å¹¿ä¸œçœ", "position": [112.792046, 23.087862], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é«˜èŒ‚è™<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœè‚‡åº†å¸‚é«˜è¦åŒºåˆ›ä¸šå››è·¯"}, {"name": "é«˜å°äº‘", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é«˜å°äº‘<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "éª†ç¤¼å†›", "address": "å¹¿ä¸œçœè‚‡åº†å¸‚é«˜è¦åŒºY184ä¸Y235äº¤å‰å£ä¸œåŒ—æ–¹å‘1430ç±³å·¦å³", "province": "å¹¿ä¸œçœ", "position": [112.458055, 23.02474], "content": "<b>ğŸ‘¤ å§“åï¼š</b>éª†ç¤¼å†›<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœè‚‡åº†å¸‚é«˜è¦åŒºY184ä¸Y235äº¤å‰å£ä¸œåŒ—æ–¹å‘1430ç±³å·¦å³"}, {"name": "é©¬ç£Š", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é©¬ç£Š<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}, {"name": "é©¬æ°æ—", "address": "å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·", "province": "å¹¿ä¸œçœ", "position": [113.914478, 23.040178], "content": "<b>ğŸ‘¤ å§“åï¼š</b>é©¬æ°æ—<br/><b>ğŸ“ åœ°å€ï¼š</b>å¹¿ä¸œçœ å¹¿ä¸œçœä¸œèå¸‚è¶…ä¸œè·¯82å·"}];
  var provinceCounts = {"å¹¿ä¸œçœ": 21, "å››å·çœ": 2, "å®‰å¾½çœ": 1, "æ±Ÿè‹çœ": 1, "æ¹–åŒ—çœ": 1, "ç¦å»ºçœ": 1};
  var infoWin = new AMap.InfoWindow({ offset: new AMap.Pixel(0,-30) });

  // â€”â€” åŒåæ ‡åƒç´ åç§»ï¼ˆé»„é‡‘è§’ï¼‰â€”â€”
  var seen = Object.create(null), GOLDEN=2.3999632297, PIX_BASE=10;
  var smallRedIcon = new AMap.Icon({
    size: new AMap.Size(14,20),
    image: 'https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png',
    imageSize: new AMap.Size(14,20)
  });

  var markers = points.map(function(p){
    var key = p.position[0].toFixed(6)+','+p.position[1].toFixed(6);
    var n = (seen[key]||0); seen[key] = n+1;

    var off = new AMap.Pixel(0,0);
    if(n>0){ var r=PIX_BASE*Math.sqrt(n), t=GOLDEN*n; off = new AMap.Pixel(r*Math.cos(t), r*Math.sin(t)); }

    var m = new AMap.Marker({ position:p.position, title:p.name, offset:off, icon:smallRedIcon, zIndex:120+n });
    m.on('click', function(){ infoWin.setContent('<div style="font-size:14px;">'+p.content+'</div>'); infoWin.open(map, p.position); });
    return m;
  });
  map.add(markers);
  if (markers.length) map.setFitView(markers, true, [50,50,50,50]);
  LOG('markers:', markers.length);

  // â€”â€” åç§°å½’ä¸€åŒ–ï¼ˆå¹¿ä¸œçœ/å¹¿ä¸œï¼‰â€”â€”
  function norm(n){ return (n||'').replace(/(çœ|å¸‚|ç‰¹åˆ«è¡Œæ”¿åŒº|ç»´å¾å°”è‡ªæ²»åŒº|å›æ—è‡ªæ²»åŒº|å£®æ—è‡ªæ²»åŒº|è‡ªæ²»åŒº)$/,''); }

  // â€”â€” ä»…ç”¨ DistrictSearch é«˜äº®çœä»½ + äººæ•°æ ‡ç­¾ â€”â€” 
  AMap.plugin('AMap.DistrictSearch', function(){
    var ds = new AMap.DistrictSearch({ level:'province', extensions:'all', subdistrict:0 });
    var provList = Object.keys(provinceCounts);
    LOG('DistrictSearch loaded; query:', provList.join('ã€'));

    provList.forEach(function(provName, idx){
      setTimeout(function(){
        var q = norm(provName);
        LOG('[DS] search', provName, '=>', q);
        ds.search(q, function(status, result){
          LOG('[DS] status:', status);
          if (status!=='complete' || !result || !result.districtList || !result.districtList.length) return;

          var dist = result.districtList[0];
          var boundaries = dist.boundaries || [];
          LOG(provName, 'boundaries:', boundaries.length);
          if (!boundaries.length) return;

          // ç”»æµ…è“å¤šè¾¹å½¢
          var baseOpts = {
            strokeColor:'#1976d2',
            strokeOpacity:0.9,
            strokeWeight:2,
            fillColor:'#64b5f6',
            fillOpacity:0.35,
            zIndex:300
          };
          function toPath(path){
            if (typeof path==='string') {
              return path.split(';').map(function(pair){ var a=pair.split(','); return [parseFloat(a[0]), parseFloat(a[1])]; });
            }
            if (Array.isArray(path) && path.length && typeof path[0]==='string') {
              return path.map(function(pair){ var a=pair.split(','); return [parseFloat(a[0]), parseFloat(a[1])]; });
            }
            return path;
          }

          var polys = boundaries.map(function(b){
            var poly = new AMap.Polygon(Object.assign({ path: toPath(b) }, baseOpts));
            poly.on('mouseover', function(){ poly.setOptions({ fillOpacity:0.5, strokeWeight:3 }); });
            poly.on('mouseout',  function(){ poly.setOptions({ fillOpacity:0.35, strokeWeight:2 }); });
            poly.setMap(map);
            return poly;
          });

          if (polys.length){
            var ub = polys[0].getBounds();
            for (var i=1;i<polys.length;i++) ub = ub.union(polys[i].getBounds());
            var center = ub.getCenter();

            var key = norm(dist.name);
            var cnt = provinceCounts[dist.name] || provinceCounts[key] || provinceCounts[key+'çœ'] || 0;

            new AMap.Text({
              position: center,
              text: dist.name + 'ï¼šå…± ' + cnt + ' äºº',
              style: {
                background:'rgba(255,255,255,0.95)', padding:'4px 8px',
                border:'1px solid #1976d2', 'border-radius':'4px', 'font-weight':'bold'
              },
              zIndex: 400
            }).setMap(map);
          }
        });
      }, idx*220); // ç®€å•èŠ‚æµï¼Œé¿å…å¹¶å‘é™æµ
    });
  });

  map.addControl(new AMap.ToolBar());
  map.addControl(new AMap.Scale());
})();
</script>
</body>
</html>